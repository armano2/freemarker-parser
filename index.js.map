{"version":3,"file":"index.js.map","sources":["src/ParserError.ts","src/Types.ts","src/Symbols.ts","src/Parser.ts"],"sourcesContent":["export default class ParserError extends Error {\n  constructor (m : string) {\n      super(m)\n\n      // Set the prototype explicitly.\n      Object.setPrototypeOf(this, ParserError.prototype)\n  }\n}\n","export enum ETypeSymbol {\n  None,\n  Directive,\n  Macro,\n  Print,\n}\n\n// TODO: change this to object with configuration\n// - allowParams\n// - allowChildrens\nexport enum EType {\n  Program = '@program',\n  Text = '@text',\n  MacroCall = '@macro',\n  // Build in macro\n  if = 'if',\n    else = 'else',\n    elseif = 'elseif',\n  list = 'list',\n  include = 'include',\n  assign = 'assign',\n  attempt = 'attempt',\n  compress = 'compress',\n  escape = 'escape',\n    noescape = 'noescape',\n  fallback = 'fallback',\n  function = 'function',\n  flush = 'flush',\n  global = 'global',\n  import = 'import',\n  local = 'local',\n  lt = 'lt',\n  macro = 'macro',\n  nested = 'nested',\n  nt = 'nt',\n  recover = 'recover',\n  recurse = 'recurse',\n  return = 'return',\n  rt = 'rt',\n  setting = 'setting',\n  stop = 'stop',\n  switch = 'switch',\n    // else = 'else',\n    case = 'case',\n    break = 'break',\n  t = 't',\n  visit = 'visit',\n}\n","import { ETypeSymbol } from './Types'\n\nexport interface ISymbol {\n  startToken : string\n  endToken : string\n  type : ETypeSymbol\n}\n\nexport const symbols : ISymbol[] = [\n  { startToken: '<#', endToken: '>', type: ETypeSymbol.Directive },\n  { startToken: '<@', endToken: '>', type: ETypeSymbol.Macro },\n  // tslint:disable-next-line:no-invalid-template-strings\n  { startToken: '${', endToken: '}', type: ETypeSymbol.Print },\n]\n\nexport const whitespaces : string[] = [\n  ' ',\n  '\\t',\n  '\\n',\n  '\\r',\n]\n","import { INode } from './Node'\nimport ParserError from './ParserError'\nimport { ISymbol, symbols, whitespaces } from './Symbols'\nimport { EType, ETypeSymbol } from './Types'\n\nexport class Parser {\n  private pos : number = 0\n  private template : string = ''\n  private AST : INode\n\n  constructor () {\n    this.template = ''\n    this.AST = this.makeNode(0, 0, EType.Program)\n    this.pos = 0\n  }\n\n  public parseTokens () {\n    while (this.pos >= 0 && this.pos < this.template.length) {\n      const token = this.parseNode(this.AST)\n      if (!token) {\n        this.AST.childrens.push(this.makeNode(this.pos, this.template.length))\n        break\n      }\n    }\n  }\n\n  public parse (template : string) : object {\n    this.template = template\n    this.AST = this.makeNode(0, 0, EType.Program)\n    this.pos = 0\n    this.parseTokens()\n    return this.AST\n  }\n\n  private makeNode (startPos : number, endPos : number, type : EType = EType.Text, params : string[] = [], tag : string = '') : INode {\n    return {\n      type,\n      tag,\n      text: type !== EType.Text ? '' : this.template.substring(startPos, endPos),\n      params,\n      loc: {\n        startPos,\n        endPos,\n      },\n      childrens: [],\n    }\n  }\n\n  private getNextWhitespacePos () : number {\n    let pos = -1\n    for (const item of whitespaces) {\n      const n = this.template.indexOf(item, this.pos)\n      if (n >= 0 && (pos === -1 || n < pos)) {\n        pos = n\n      }\n    }\n    return pos\n  }\n\n  private parseTag () : string {\n    const pos = this.getNextWhitespacePos()\n    if (pos < 0) {\n      throw new ParserError('Missing closing tag') // TODO: add more info like location\n    }\n    return this.template.substring(this.pos, pos)\n  }\n\n  private parseNode (parent : INode) : boolean {\n    let symbol : ISymbol | null = null\n    let startPos : number = 0\n    for (const item of symbols) {\n      const n = this.template.indexOf(item.startToken, this.pos)\n      if (n >= 0 && (!symbol || n < startPos)) {\n        symbol = item,\n        startPos = n\n      }\n    }\n\n    if (!symbol) {\n      return false\n    }\n\n    if (startPos - 1 > this.pos) {\n      parent.childrens.push(this.makeNode(this.pos, startPos - 1))\n      this.pos = startPos\n    }\n\n    this.pos += symbol.startToken.length\n\n    let typeString : string = ''\n    const params : string[] = []\n    let node : INode | null = null\n\n    // TODO: split this to separate functions\n    switch (symbol.type) {\n      case ETypeSymbol.Directive:\n        typeString = this.parseTag()\n        if (!(typeString in EType)) {\n          throw new ParserError(`Unsupported directive ${typeString}`) // TODO: add more info like location\n        }\n        this.pos += typeString.length\n        // TODO; read params\n\n        node = this.makeNode(startPos, this.pos, typeString as EType, params)\n        break\n      case ETypeSymbol.Macro:\n        typeString = this.parseTag()\n        this.pos += typeString.length\n        // TODO; read params\n\n        node = this.makeNode(startPos, this.pos, EType.MacroCall, params, typeString)\n        break\n      case ETypeSymbol.Print:\n        // TODO: add support for expression\n        break\n    }\n\n    if (node) {\n      parent.childrens.push(node)\n    }\n\n    ++this.pos\n    return true\n  }\n}\n"],"names":[],"mappings":"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"}